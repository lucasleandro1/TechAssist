
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>Gestão de Tickets</h1>
  <%= link_to 'Novo Ticket', new_ticket_path, class: 'btn btn-primary' %>
</div>

<div class="row mb-4">
  <% @tickets.group_by(&:status).each do |status, tickets| %>
    <div class="col-md-3 mb-3">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="card-title"><%= status %></h5>
          <p class="card-text display-4"><%= tickets.count %></p>
          <%= link_to 'Ver Tickets', status_tickets_path(status), class: 'btn btn-outline-primary' %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<div class="card">
  <div class="card-header">
    <h3>Todos os Tickets</h3>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>ID</th>
            <th>Cliente</th>
            <th>Dispositivo</th>
            <th>Status</th>
            <th>Sintoma</th>
            <th>Data Abertura</th>
            <th>Valor Reparo</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <% @tickets.each do |ticket| %>
            <tr>
              <td><%= ticket.id %></td>
              <td><%= ticket.mobile_device.client.nome %></td>
              <td><%= "#{ticket.mobile_device.marca} #{ticket.mobile_device.modelo}" %></td>
              <td>
                <span class="badge bg-<%= status_color(ticket.status) %>">
                  <%= ticket.status %>
                </span>
              </td>
              <td><%= ticket.sintoma %></td>
              <td><%= ticket.data_abertura&.strftime('%d/%m/%Y') %></td>
              <td><%= number_to_currency(ticket.repair_price) if ticket.repair_price %></td>
              <td>
                <%= link_to 'Ver', ticket, class: 'btn btn-sm btn-outline-primary' %>
                <%= link_to 'Editar', edit_ticket_path(ticket), class: 'btn btn-sm btn-outline-secondary' %>
                <%= link_to 'Excluir', ticket, method: :delete, 
                    confirm: 'Tem certeza?', class: 'btn btn-sm btn-outline-danger' %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
